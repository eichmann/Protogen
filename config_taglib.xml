<project xmlns:ivy="antlib:org.apache.ivy.ant" name="ConfigureTagLibProject" default="setup">

	<property environment="env" />

	<!--  all properties are in build.properties -->
	<property file="${user.name}.properties" />
	<property file="/home/hudson/db.config.properties" />
	<property file="build.properties" />

	<property name="default.dir" value="TAGLIB_DEFAULT" />
	
	<taskdef resource="net/sf/antcontrib/antlib.xml"/>
	
	<target name="set_workspace_var">
		  <propertyregex property="workspace" input="${osgi.instance.area}" regexp="file:(.*)" select="\1"/>
	</target>

	
	
	<target name="GetProjectName">
		<input message="Please enter TAGLIB Eclipse Project (Example: 'MyProjectTagLib'): " addproperty="target.project.name" />
		
		<echo>Entered TAGLIB Project Name  : ${target.project.name}</echo>
	</target>
	

	
	
	
	<target name="setup" depends="set_workspace_var,GetProjectName">
		<property name="target.dir" value="/${workspace}/${target.project.name}/" />
		<antcall target="copy_ivy_config" />
		<antcall target="copy_default_build_files" />
		<antcall target="copy_default_properties" />
		<eclipse.refreshLocal resource="${target.project.name}"/>
		<ant antfile="build.xml"  dir="${target.dir}" target="resolve-dependencies_sync" inheritall="false"/>
		<antcall target="copy-clay" />
		<!-- <antcall target="run_target_generator" /> -->
		<eclipse.refreshLocal resource="${target.project.name}"/>

	</target>

	
	<target name="check-clay">
	    <available file="${target.dir}/WebContent/resources/${target.project.name}.clay" property="clay.exists"/>
	</target>

	<target name="copy-clay" depends="check-clay" unless="clay.exists">
		
		<copy tofile="${target.dir}/WebContent/resources/${target.project.name}.clay"  overwrite="false" >
				<fileset file="${default.dir}/Temp.clay" />
		</copy>
		<replace dir="${target.dir}/WebContent/resources" token="@CURRENT@" value="${target.project.name}">
			<include  name="*.clay" />		
		</replace>
		
	</target>
	
	
	<target name="run_target_generator">
		<ant antfile="build.xml"  dir="${target.dir}" target="run_generator" inheritall="false"/>
	</target>

	
	
	
	<target name="copy_ivy_config" >
		<copy todir="${target.dir}" overwrite="false" >
			<fileset file="${default.dir}/ivy.xml" />
			<fileset file="${default.dir}/ivysettings.xml" />

		</copy>
		<!-- Any token replacements should happen now -->
	</target>

	
	<target name="copy_default_build_files">
		<copy todir="${target.dir}" overwrite="false" >
			<fileset file="${default.dir}/build.xml" />
			<fileset file="${default.dir}/build.properties" />
			<fileset file="${default.dir}/../custom/${user.name}.properties" />
		</copy>
		<replace file="${target.dir}/build.properties" token="@CURRENT@" value="${target.project.name}"/>
		<replace file="${target.dir}/build.properties" token="@TARGET@" value="${target.project.name}"/>
		<replace file="${target.dir}/build.properties" token="@WORKSPACE@" value="${workspace}"/>
		<mkdir dir="${env.HOME}/icts_dev/extjars" />
	</target>
	
	<target name="copy_default_properties">
		<mkdir dir="${target.dir}/WebContent/resources" />
		<copy todir="${target.dir}/WebContent/META-INF" overwrite="false" >
			<fileset file="${default.dir}/context.xml" />
			<fileset file="${default.dir}/context-test.xml" />
		</copy>
		
		<replace dir="${target.dir}/WebContent/META-INF" token="@CURRENT@" value="${target.project.name}">
			<include  name="*.xml" />		
		</replace>
	</target>


	
</project>